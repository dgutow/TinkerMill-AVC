<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>module MonitorMixin - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/jquery.js"></script>
<script src="./js/darkfish.js"></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="module">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>

  <ul class="link-list" role="directory">
    <li><a href="#module-MonitorMixin-label-Examples">Examples</a>
    <li><a href="#module-MonitorMixin-label-Simple+object.extend">Simple object.extend</a>
    <li><a href="#module-MonitorMixin-label-Simple+Class+include">Simple Class include</a>
  </ul>
</div>


  <div id="class-metadata">
    
    
    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-extend_object">::extend_object</a>
    
    <li class="calls-super" ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-mon_check_owner">#mon_check_owner</a>
    
    <li ><a href="#method-i-mon_enter">#mon_enter</a>
    
    <li ><a href="#method-i-mon_enter_for_cond">#mon_enter_for_cond</a>
    
    <li ><a href="#method-i-mon_exit">#mon_exit</a>
    
    <li ><a href="#method-i-mon_exit_for_cond">#mon_exit_for_cond</a>
    
    <li ><a href="#method-i-mon_initialize">#mon_initialize</a>
    
    <li ><a href="#method-i-mon_synchronize">#mon_synchronize</a>
    
    <li ><a href="#method-i-mon_try_enter">#mon_try_enter</a>
    
    <li ><a href="#method-i-new_cond">#new_cond</a>
    
    <li ><a href="#method-i-synchronize">#synchronize</a>
    
    <li ><a href="#method-i-try_mon_enter">#try_mon_enter</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="module-MonitorMixin">
  <h1 id="module-MonitorMixin" class="module">
    module MonitorMixin
  </h1>

  <section class="description">
    
<p>In concurrent programming, a monitor is an object or module intended to be
used safely by more than one thread.  The defining characteristic of a
monitor is that its methods are executed with mutual exclusion.  That is,
at each point in time, at most one thread may be executing any of its
methods. This mutual exclusion greatly simplifies reasoning about the
implementation of monitors compared to reasoning about parallel code that
updates a data structure.</p>

<p>You can read more about the general principles on the Wikipedia page for <a
href="http://en.wikipedia.org/wiki/Monitor_%28synchronization%29">Monitors</a></p>

<h2 id="module-MonitorMixin-label-Examples">Examples<span><a href="#module-MonitorMixin-label-Examples">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h3 id="module-MonitorMixin-label-Simple+object.extend">Simple object.extend<span><a href="#module-MonitorMixin-label-Simple+object.extend">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;monitor.rb&#39;</span>

<span class="ruby-identifier">buf</span> = []
<span class="ruby-identifier">buf</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">MonitorMixin</span>)
<span class="ruby-identifier">empty_cond</span> = <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">new_cond</span>

<span class="ruby-comment"># consumer</span>
<span class="ruby-constant">Thread</span>.<span class="ruby-identifier">start</span> <span class="ruby-keyword">do</span>
  <span class="ruby-identifier">loop</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">empty_cond</span>.<span class="ruby-identifier">wait_while</span> { <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">empty?</span> }
      <span class="ruby-identifier">print</span> <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>

<span class="ruby-comment"># producer</span>
<span class="ruby-keyword">while</span> <span class="ruby-identifier">line</span> = <span class="ruby-constant">ARGF</span>.<span class="ruby-identifier">gets</span>
  <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">buf</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-identifier">empty_cond</span>.<span class="ruby-identifier">signal</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<p>The consumer thread waits for the producer thread to push a line to buf
while <code>buf.empty?</code>.  The producer thread (main thread) reads a
line from <a href="ARGF.html">ARGF</a> and pushes it into buf then calls
<code>empty_cond.signal</code> to notify the consumer thread of new data.</p>

<h3 id="module-MonitorMixin-label-Simple+Class+include">Simple <a href="Class.html">Class</a> include<span><a href="#module-MonitorMixin-label-Simple+Class+include">&para;</a> <a href="#top">&uarr;</a></span></h3>

<pre class="ruby"><span class="ruby-identifier">require</span> <span class="ruby-string">&#39;monitor&#39;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">SynchronizedArray</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Array</span>

  <span class="ruby-identifier">include</span> <span class="ruby-constant">MonitorMixin</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
    <span class="ruby-keyword">super</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">alias</span> :<span class="ruby-identifier">old_shift</span> <span class="ruby-operator">:</span><span class="ruby-identifier">shift</span>
  <span class="ruby-keyword">alias</span> :<span class="ruby-identifier">old_unshift</span> <span class="ruby-operator">:</span><span class="ruby-identifier">unshift</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">shift</span>(<span class="ruby-identifier">n</span>=<span class="ruby-value">1</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_shift</span>(<span class="ruby-identifier">n</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">item</span>)
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">synchronize</span> <span class="ruby-keyword">do</span>
      <span class="ruby-keyword">self</span>.<span class="ruby-identifier">old_unshift</span>(<span class="ruby-identifier">item</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># other methods ...</span>
<span class="ruby-keyword">end</span>
</pre>

<p><code>SynchronizedArray</code> implements an Array with synchronized access
to items. This <a href="Class.html">Class</a> is implemented as subclass of
Array which includes the <a href="MonitorMixin.html">MonitorMixin</a>
module.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-extend_object" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">extend_object</span><span
            class="method-args">(obj)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="extend_object-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 159</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">extend_object</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">__send__</span>(<span class="ruby-value">:mon_initialize</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(*args)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Use <code>extend MonitorMixin</code> or <code>include MonitorMixin</code>
instead of this constructor.  Have look at the examples above to understand
how to use this module.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 233</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">args</span>)
  <span class="ruby-keyword">super</span>
  <span class="ruby-identifier">mon_initialize</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-mon_enter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_enter</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Enters exclusive section.</p>
          
          

          
          <div class="method-source-code" id="mon_enter-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 184</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_enter</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mon_owner</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-ivar">@mon_mutex</span>.<span class="ruby-identifier">lock</span>
    <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-ivar">@mon_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mon_exit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_exit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Leaves exclusive section.</p>
          
          

          
          <div class="method-source-code" id="mon_exit-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 196</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_exit</span>
  <span class="ruby-identifier">mon_check_owner</span>
  <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">-=</span><span class="ruby-value">1</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
    <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@mon_mutex</span>.<span class="ruby-identifier">unlock</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mon_synchronize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_synchronize</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Enters exclusive section and executes the block.  Leaves the exclusive
section automatically when the block exits.  See example under
<code>MonitorMixin</code>.</p>
          
          

          
          <div class="method-source-code" id="mon_synchronize-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_synchronize</span>
  <span class="ruby-identifier">mon_enter</span>
  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">yield</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">mon_exit</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MonitorMixin.html#method-i-synchronize">synchronize</a>
        </div>
        

        
      </div>

    
      <div id="method-i-mon_try_enter" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_try_enter</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Attempts to enter exclusive section.  Returns <code>false</code> if lock
fails.</p>
          
          

          
          <div class="method-source-code" id="mon_try_enter-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_try_enter</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mon_owner</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@mon_mutex</span>.<span class="ruby-identifier">try_lock</span>
      <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-ivar">@mon_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@mon_count</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="MonitorMixin.html#method-i-try_mon_enter">try_mon_enter</a>
        </div>
        

        
      </div>

    
      <div id="method-i-new_cond" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_cond</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a new <a
href="MonitorMixin/ConditionVariable.html">MonitorMixin::ConditionVariable</a>
associated with the receiver.</p>
          
          

          
          <div class="method-source-code" id="new_cond-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 224</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_cond</span>
  <span class="ruby-keyword">return</span> <span class="ruby-constant">ConditionVariable</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-synchronize" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">synchronize</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MonitorMixin.html#method-i-mon_synchronize">mon_synchronize</a>
        </div>
        
      </div>

    
      <div id="method-i-try_mon_enter" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">try_mon_enter</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          <p>For backward compatibility</p>
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="MonitorMixin.html#method-i-mon_try_enter">mon_try_enter</a>
        </div>
        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-mon_check_owner" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_check_owner</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mon_check_owner-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 246</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_check_owner</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@mon_owner</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">ThreadError</span>, <span class="ruby-string">&quot;current thread not owner&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mon_enter_for_cond" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_enter_for_cond</span><span
            class="method-args">(count)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mon_enter_for_cond-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 252</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_enter_for_cond</span>(<span class="ruby-identifier">count</span>)
  <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-constant">Thread</span>.<span class="ruby-identifier">current</span>
  <span class="ruby-ivar">@mon_count</span> = <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mon_exit_for_cond" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_exit_for_cond</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="mon_exit_for_cond-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 257</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_exit_for_cond</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-ivar">@mon_count</span>
  <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@mon_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">count</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mon_initialize" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mon_initialize</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Initializes the <a href="MonitorMixin.html">MonitorMixin</a> after being
included in a class or when an object has been extended with the <a
href="MonitorMixin.html">MonitorMixin</a></p>
          
          

          
          <div class="method-source-code" id="mon_initialize-source">
            <pre><span class="ruby-comment"># File lib/monitor.rb, line 240</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mon_initialize</span>
  <span class="ruby-ivar">@mon_owner</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@mon_count</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@mon_mutex</span> = <span class="ruby-constant">Thread</span><span class="ruby-operator">::</span><span class="ruby-constant">Mutex</span>.<span class="ruby-identifier">new</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

