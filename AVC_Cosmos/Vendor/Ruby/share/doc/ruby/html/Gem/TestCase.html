<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Gem::TestCase - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">MiniTest::Unit::TestCase
  
</div>

    <div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
  
  
    <li><a class="include" href="DefaultUserInteraction.html">Gem::DefaultUserInteraction</a>
  
  
  </ul>
</div>

    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-cert_path">::cert_path</a>
    
    <li ><a href="#method-c-key_path">::key_path</a>
    
    <li ><a href="#method-c-load_cert">::load_cert</a>
    
    <li ><a href="#method-c-load_key">::load_key</a>
    
    <li ><a href="#method-c-make_command">::make_command</a>
    
    <li ><a href="#method-c-process_based_port">::process_based_port</a>
    
    <li ><a href="#method-c-rubybin">::rubybin</a>
    
    <li ><a href="#method-c-vc_windows-3F">::vc_windows?</a>
    
    <li ><a href="#method-c-win_platform-3F">::win_platform?</a>
    
    <li ><a href="#method-i-add_to_fetcher">#add_to_fetcher</a>
    
    <li ><a href="#method-i-all_spec_names">#all_spec_names</a>
    
    <li ><a href="#method-i-ask_if_ok">#ask_if_ok</a>
    
    <li ><a href="#method-i-assert_activate">#assert_activate</a>
    
    <li ><a href="#method-i-assert_contains_make_command">#assert_contains_make_command</a>
    
    <li ><a href="#method-i-assert_path_exists">#assert_path_exists</a>
    
    <li ><a href="#method-i-build_rake_in">#build_rake_in</a>
    
    <li ><a href="#method-i-common_installer_setup">#common_installer_setup</a>
    
    <li ><a href="#method-i-common_installer_teardown">#common_installer_teardown</a>
    
    <li ><a href="#method-i-create_tmpdir">#create_tmpdir</a>
    
    <li ><a href="#method-i-dep">#dep</a>
    
    <li ><a href="#method-i-dependency_request">#dependency_request</a>
    
    <li ><a href="#method-i-enable_shared">#enable_shared</a>
    
    <li ><a href="#method-i-git_gem">#git_gem</a>
    
    <li ><a href="#method-i-have_git-3F">#have_git?</a>
    
    <li ><a href="#method-i-install_default_gems">#install_default_gems</a>
    
    <li ><a href="#method-i-install_default_specs">#install_default_specs</a>
    
    <li ><a href="#method-i-install_gem">#install_gem</a>
    
    <li ><a href="#method-i-install_gem_user">#install_gem_user</a>
    
    <li ><a href="#method-i-install_specs">#install_specs</a>
    
    <li ><a href="#method-i-loaded_spec_names">#loaded_spec_names</a>
    
    <li ><a href="#method-i-make_command">#make_command</a>
    
    <li ><a href="#method-i-mu_pp">#mu_pp</a>
    
    <li ><a href="#method-i-new_default_spec">#new_default_spec</a>
    
    <li ><a href="#method-i-nmake_found-3F">#nmake_found?</a>
    
    <li ><a href="#method-i-parse_make_command_line">#parse_make_command_line</a>
    
    <li ><a href="#method-i-process_based_port">#process_based_port</a>
    
    <li ><a href="#method-i-quick_gem">#quick_gem</a>
    
    <li ><a href="#method-i-read_binary">#read_binary</a>
    
    <li ><a href="#method-i-read_cache">#read_cache</a>
    
    <li ><a href="#method-i-refute_path_exists">#refute_path_exists</a>
    
    <li ><a href="#method-i-req">#req</a>
    
    <li ><a href="#method-i-save_gemspec">#save_gemspec</a>
    
    <li ><a href="#method-i-save_loaded_features">#save_loaded_features</a>
    
    <li ><a href="#method-i-scan_make_command_lines">#scan_make_command_lines</a>
    
    <li class="calls-super" ><a href="#method-i-setup">#setup</a>
    
    <li ><a href="#method-i-spec">#spec</a>
    
    <li ><a href="#method-i-spec_fetcher">#spec_fetcher</a>
    
    <li ><a href="#method-i-teardown">#teardown</a>
    
    <li ><a href="#method-i-uninstall_gem">#uninstall_gem</a>
    
    <li ><a href="#method-i-unresolved_names">#unresolved_names</a>
    
    <li ><a href="#method-i-util_build_gem">#util_build_gem</a>
    
    <li ><a href="#method-i-util_clear_gems">#util_clear_gems</a>
    
    <li ><a href="#method-i-util_gem">#util_gem</a>
    
    <li ><a href="#method-i-util_gzip">#util_gzip</a>
    
    <li ><a href="#method-i-util_make_gems">#util_make_gems</a>
    
    <li ><a href="#method-i-util_remove_gem">#util_remove_gem</a>
    
    <li ><a href="#method-i-util_restore_RUBY_VERSION">#util_restore_RUBY_VERSION</a>
    
    <li ><a href="#method-i-util_set_RUBY_VERSION">#util_set_RUBY_VERSION</a>
    
    <li ><a href="#method-i-util_set_arch">#util_set_arch</a>
    
    <li ><a href="#method-i-util_setup_fake_fetcher">#util_setup_fake_fetcher</a>
    
    <li ><a href="#method-i-util_setup_spec_fetcher">#util_setup_spec_fetcher</a>
    
    <li ><a href="#method-i-util_spec">#util_spec</a>
    
    <li ><a href="#method-i-util_zip">#util_zip</a>
    
    <li ><a href="#method-i-v">#v</a>
    
    <li ><a href="#method-i-vc_windows-3F">#vc_windows?</a>
    
    <li ><a href="#method-i-vendor_gem">#vendor_gem</a>
    
    <li ><a href="#method-i-wait_for_child_process_to_exit">#wait_for_child_process_to_exit</a>
    
    <li ><a href="#method-i-win_platform-3F">#win_platform?</a>
    
    <li ><a href="#method-i-write_file">#write_file</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Gem::TestCase">
  <h1 id="class-Gem::TestCase" class="class">
    class Gem::TestCase
  </h1>

  <section class="description">
    
<p>RubyGemTestCase provides a variety of methods for testing rubygems and
gem-related behavior in a sandbox.  Through RubyGemTestCase you can install
and uninstall gems, fetch remote gems through a stub fetcher and be assured
your normal set of gems is not affected.</p>

<p>Tests are always run at a safe level of 1.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-cert_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cert_path</span><span
            class="method-args">(cert_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the path to the certificate named <code>cert_name</code> from
<code>test/rubygems/</code>.</p>
          
          

          
          <div class="method-source-code" id="cert_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1430</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">cert_path</span> <span class="ruby-identifier">cert_name</span>
  <span class="ruby-keyword">if</span> <span class="ruby-value">32</span> <span class="ruby-operator">==</span> (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">at</span>(<span class="ruby-value">2</span><span class="ruby-operator">**</span><span class="ruby-value">32</span>) <span class="ruby-keyword">rescue</span> <span class="ruby-value">32</span>) <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">cert_file</span> =
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-node">&quot;../../../test/rubygems/#{cert_name}_cert_32.pem&quot;</span>,
                       <span class="ruby-keyword">__FILE__</span>

    <span class="ruby-keyword">return</span> <span class="ruby-identifier">cert_file</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">cert_file</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-node">&quot;../../../test/rubygems/#{cert_name}_cert.pem&quot;</span>, <span class="ruby-keyword">__FILE__</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-key_path" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">key_path</span><span
            class="method-args">(key_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the path to the key named <code>key_name</code> from
<code>test/rubygems</code></p>
          
          

          
          <div class="method-source-code" id="key_path-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1456</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">key_path</span> <span class="ruby-identifier">key_name</span>
  <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-node">&quot;../../../test/rubygems/#{key_name}_key.pem&quot;</span>, <span class="ruby-keyword">__FILE__</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_cert" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_cert</span><span
            class="method-args">(cert_name)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads certificate named <code>cert_name</code> from
<code>test/rubygems/</code>.</p>
          
          

          
          <div class="method-source-code" id="load_cert-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1418</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">load_cert</span> <span class="ruby-identifier">cert_name</span>
  <span class="ruby-identifier">cert_file</span> = <span class="ruby-identifier">cert_path</span> <span class="ruby-identifier">cert_name</span>

  <span class="ruby-identifier">cert</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">cert_file</span>

  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">cert</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-load_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_key</span><span
            class="method-args">(key_name, passphrase = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Loads an RSA private key named <code>key_name</code> with
<code>passphrase</code> in <code>test/rubygems/</code></p>
          
          

          
          <div class="method-source-code" id="load_key-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1445</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">load_key</span> <span class="ruby-identifier">key_name</span>, <span class="ruby-identifier">passphrase</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">key_file</span> = <span class="ruby-identifier">key_path</span> <span class="ruby-identifier">key_name</span>

  <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span> <span class="ruby-identifier">key_file</span>

  <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">passphrase</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-make_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_command</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the make command for the current platform. For versions of Ruby
built on MS Windows with VC++ or Borland it will return &#39;nmake&#39;. On
all other platforms, including Cygwin, it will return &#39;make&#39;.</p>
          
          

          
          <div class="method-source-code" id="make_command-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1150</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">make_command</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;make&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;MAKE&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;nmake&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;make&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-process_based_port" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_based_port</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows tests to use a random (but controlled) port number instead of a
hardcoded one. This helps CI tools when running parallels builds on the
same builder slave.</p>
          
          

          
          <div class="method-source-code" id="process_based_port-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1183</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">process_based_port</span>
  <span class="ruby-identifier">@@process_based_port</span> <span class="ruby-operator">||=</span> <span class="ruby-value">8000</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">$$</span> <span class="ruby-operator">%</span> <span class="ruby-value">1000</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-rubybin" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rubybin</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Finds the path to the Ruby executable</p>
          
          

          
          <div class="method-source-code" id="rubybin-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1216</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rubybin</span>
  <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;RUBY&quot;</span>]
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ruby</span>
  <span class="ruby-identifier">ruby</span> = <span class="ruby-string">&quot;ruby&quot;</span>
  <span class="ruby-identifier">rubyexe</span> = <span class="ruby-node">&quot;#{ruby}.exe&quot;</span>

  <span class="ruby-value">3</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">ruby</span> <span class="ruby-keyword">and</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">ruby</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">ruby</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">rubyexe</span> <span class="ruby-keyword">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span> <span class="ruby-identifier">rubyexe</span>
      <span class="ruby-keyword">return</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">rubyexe</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;..&quot;</span>, <span class="ruby-identifier">ruby</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-identifier">require</span> <span class="ruby-string">&quot;rbconfig&quot;</span>
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;bindir&quot;</span>],
              <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;ruby_install_name&quot;</span>] <span class="ruby-operator">+</span>
              <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&quot;EXEEXT&quot;</span>])
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">LoadError</span>
    <span class="ruby-string">&quot;ruby&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-vc_windows-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">vc_windows?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns whether or not we&#39;re on a version of Ruby built with VC++ (or
Borland) versus Cygwin, Mingw, etc.</p>
          
          

          
          <div class="method-source-code" id="vc_windows-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1133</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">vc_windows?</span>
  <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&#39;mswin&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-win_platform-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">win_platform?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is this test being run on a Windows platform?</p>
          
          

          
          <div class="method-source-code" id="win_platform-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1118</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">win_platform?</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add_to_fetcher" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">add_to_fetcher</span><span
            class="method-args">(spec, path=nil, repo=@gem_repo)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Add <code>spec</code> to +@fetcher+ serving the data in the file
<code>path</code>. <code>repo</code> indicates which repo to make
<code>spec</code> appear to be in.</p>
          
          

          
          <div class="method-source-code" id="add_to_fetcher-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1011</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_to_fetcher</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">path</span>=<span class="ruby-keyword">nil</span>, <span class="ruby-identifier">repo</span>=<span class="ruby-ivar">@gem_repo</span>)
  <span class="ruby-identifier">path</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
  <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}gems/#{spec.file_name}&quot;</span>] = <span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">path</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-all_spec_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">all_spec_names</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="all_spec_names-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 602</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">all_spec_names</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ask_if_ok" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ask_if_ok</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ask_if_ok-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 543</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ask_if_ok</span> <span class="ruby-identifier">spec</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_activate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_activate</span><span
            class="method-args">(expected, *specs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="assert_activate-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_activate</span> <span class="ruby-identifier">expected</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword">then</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">find_by_name</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">activate</span>
    <span class="ruby-keyword">when</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">activate</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">flunk</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">inspect</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">loaded</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>)

  <span class="ruby-identifier">assert_equal</span> <span class="ruby-identifier">expected</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-identifier">loaded</span>.<span class="ruby-identifier">sort</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">expected</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_contains_make_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_contains_make_command</span><span
            class="method-args">(target, output, msg = nil) { |make, line| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="assert_contains_make_command-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_contains_make_command</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">output</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">output</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/\n/</span>)
    <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) {
      <span class="ruby-string">&#39;Expected output containing make command &quot;%s&quot;: %s&#39;</span> <span class="ruby-operator">%</span> [
        (<span class="ruby-string">&#39;%s %s&#39;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">make_command</span>, <span class="ruby-identifier">target</span>]).<span class="ruby-identifier">rstrip</span>,
        <span class="ruby-identifier">output</span>.<span class="ruby-identifier">inspect</span>
      ]
    }
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) {
      <span class="ruby-string">&#39;Expected make command &quot;%s&quot;: %s&#39;</span> <span class="ruby-operator">%</span> [
        (<span class="ruby-string">&#39;%s %s&#39;</span> <span class="ruby-operator">%</span> [<span class="ruby-identifier">make_command</span>, <span class="ruby-identifier">target</span>]).<span class="ruby-identifier">rstrip</span>,
        <span class="ruby-identifier">output</span>.<span class="ruby-identifier">inspect</span>
      ]
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">assert</span> <span class="ruby-identifier">scan_make_command_lines</span>(<span class="ruby-identifier">output</span>).<span class="ruby-identifier">any?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">make</span> = <span class="ruby-identifier">parse_make_command_line</span>(<span class="ruby-identifier">line</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">make</span>[<span class="ruby-value">:targets</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">target</span>)
      <span class="ruby-keyword">yield</span> <span class="ruby-identifier">make</span>, <span class="ruby-identifier">line</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  }, <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-assert_path_exists" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assert_path_exists</span><span
            class="method-args">(path, msg = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: move to minitest</p>
          
          

          
          <div class="method-source-code" id="assert_path_exists-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 111</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assert_path_exists</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path &#39;#{path}&#39; to exist&quot;</span> }
  <span class="ruby-identifier">assert</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_rake_in" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_rake_in</span><span
            class="method-args">(good=true) { |rake| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Allows the proper version of <code>rake</code> to be used for the test.</p>
          
          

          
          <div class="method-source-code" id="build_rake_in-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1197</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_rake_in</span>(<span class="ruby-identifier">good</span>=<span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">gem_ruby</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-identifier">@@ruby</span>
  <span class="ruby-identifier">env_rake</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>]
  <span class="ruby-identifier">rake</span> = (<span class="ruby-identifier">good</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">@@good_rake</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">@@bad_rake</span>)
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>] = <span class="ruby-identifier">rake</span>
  <span class="ruby-keyword">yield</span> <span class="ruby-identifier">rake</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-identifier">gem_ruby</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">env_rake</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;rake&quot;</span>] = <span class="ruby-identifier">env_rake</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&quot;rake&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-common_installer_setup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">common_installer_setup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="common_installer_setup-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 414</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">common_installer_setup</span>
  <span class="ruby-identifier">common_installer_teardown</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_build_hook_arg</span> = <span class="ruby-identifier">installer</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@post_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">installer</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@pre_install_hook_arg</span> = <span class="ruby-identifier">installer</span>
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">uninstaller</span><span class="ruby-operator">|</span>
    <span class="ruby-ivar">@pre_uninstall_hook_arg</span> = <span class="ruby-identifier">uninstaller</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-common_installer_teardown" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">common_installer_teardown</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="common_installer_teardown-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 440</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">common_installer_teardown</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_build_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_install_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">done_installing_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_reset_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">post_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_install_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_reset_hooks</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">pre_uninstall_hooks</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-create_tmpdir" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">create_tmpdir</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>creates a temporary directory with hax TODO: deprecate and remove</p>
          
          

          
          <div class="method-source-code" id="create_tmpdir-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 553</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">create_tmpdir</span>
  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span> <span class="ruby-keyword">do</span> <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span> <span class="ruby-keyword">end</span> <span class="ruby-comment"># HACK OSX /private/tmp</span>
  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">tmpdir</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">tmpdir</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dep" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dep</span><span
            class="method-args">(name, *requirements)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Construct a new <a href="Dependency.html">Gem::Dependency</a>.</p>
          
          

          
          <div class="method-source-code" id="dep-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1249</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dep</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Dependency</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dependency_request" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dependency_request</span><span
            class="method-args">(dep, from_name, from_version, parent = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constructs a <a
href="Resolver/DependencyRequest.html">Gem::Resolver::DependencyRequest</a>
from a <a href="Dependency.html">Gem::Dependency</a> <code>dep</code>, a
<code>from_name</code> and <code>from_version</code> requesting the
dependency and a <code>parent</code> DependencyRequest</p>
          
          

          
          <div class="method-source-code" id="dependency_request-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1258</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dependency_request</span> <span class="ruby-identifier">dep</span>, <span class="ruby-identifier">from_name</span>, <span class="ruby-identifier">from_version</span>, <span class="ruby-identifier">parent</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">remote</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Source</span>.<span class="ruby-identifier">new</span> <span class="ruby-ivar">@uri</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">parent</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">parent_dep</span> = <span class="ruby-identifier">dep</span> <span class="ruby-identifier">from_name</span>, <span class="ruby-identifier">from_version</span>
    <span class="ruby-identifier">parent</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Resolver</span><span class="ruby-operator">::</span><span class="ruby-constant">DependencyRequest</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">parent_dep</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Resolver</span><span class="ruby-operator">::</span><span class="ruby-constant">IndexSpecification</span>.<span class="ruby-identifier">new</span>        <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">from_name</span>, <span class="ruby-identifier">from_version</span>, <span class="ruby-identifier">remote</span>, <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
  <span class="ruby-identifier">activation</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Resolver</span><span class="ruby-operator">::</span><span class="ruby-constant">ActivationRequest</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">spec</span>, <span class="ruby-identifier">parent</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Resolver</span><span class="ruby-operator">::</span><span class="ruby-constant">DependencyRequest</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">dep</span>, <span class="ruby-identifier">activation</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-enable_shared" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">enable_shared</span><span
            class="method-args">(value) { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets the ENABLE_SHARED entry in RbConfig::CONFIG to <code>value</code> and
restores the original value when the block ends</p>
          
          

          
          <div class="method-source-code" id="enable_shared-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 120</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">enable_shared</span> <span class="ruby-identifier">value</span>
  <span class="ruby-identifier">enable_shared</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ENABLE_SHARED&#39;</span>]
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ENABLE_SHARED&#39;</span>] = <span class="ruby-identifier">value</span>

  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">enable_shared</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;enable_shared&#39;</span>] = <span class="ruby-identifier">enable_shared</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;enable_shared&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-git_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">git_gem</span><span
            class="method-args">(name = 'a', version = 1) { |specification| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A <a href="TestCase.html#method-i-git_gem">#git_gem</a> is used with a gem
dependencies file.  The gem created here has no files, just a gem
specification for the given <code>name</code> and <code>version</code>.</p>

<p>Yields the <code>specification</code> to the block, if given</p>
          
          

          
          <div class="method-source-code" id="git_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 457</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">git_gem</span> <span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">have_git?</span>

  <span class="ruby-identifier">directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">&#39;git&#39;</span>, <span class="ruby-identifier">name</span>
  <span class="ruby-identifier">directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-identifier">directory</span>

  <span class="ruby-identifier">git_spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">specification</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">specification</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">directory</span>

  <span class="ruby-identifier">gemspec</span> = <span class="ruby-node">&quot;#{name}.gemspec&quot;</span>

  <span class="ruby-identifier">open</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-identifier">gemspec</span>), <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">git_spec</span>.<span class="ruby-identifier">to_ruby</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">head</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">directory</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-string">&#39;.git&#39;</span> <span class="ruby-keyword">then</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;init&#39;</span>, <span class="ruby-string">&#39;--quiet&#39;</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;config&#39;</span>, <span class="ruby-string">&#39;user.name&#39;</span>,  <span class="ruby-string">&#39;RubyGems Tests&#39;</span>
      <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;config&#39;</span>, <span class="ruby-string">&#39;user.email&#39;</span>, <span class="ruby-string">&#39;rubygems@example&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;add&#39;</span>, <span class="ruby-identifier">gemspec</span>
    <span class="ruby-identifier">system</span> <span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;commit&#39;</span>, <span class="ruby-string">&#39;-a&#39;</span>, <span class="ruby-string">&#39;-m&#39;</span>, <span class="ruby-string">&#39;a non-empty commit message&#39;</span>, <span class="ruby-string">&#39;--quiet&#39;</span>
    <span class="ruby-identifier">head</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">popen</span>(<span class="ruby-ivar">@git</span>, <span class="ruby-string">&#39;rev-parse&#39;</span>, <span class="ruby-string">&#39;master&#39;</span>).<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">git_spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">directory</span>, <span class="ruby-identifier">head</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-have_git-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">have_git?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Skips this test unless you have a git executable</p>
          
          

          
          <div class="method-source-code" id="have_git-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 495</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">have_git?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">in_path?</span> <span class="ruby-ivar">@git</span>

  <span class="ruby-identifier">skip</span> <span class="ruby-string">&#39;cannot find git executable, use GIT environment variable to set&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install_default_gems" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install_default_gems</span><span
            class="method-args">(*specs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Installs the provided default specs including writing the spec file</p>
          
          

          
          <div class="method-source-code" id="install_default_gems-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 706</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_default_gems</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">install_default_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)

  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">open</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span>, <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install_default_specs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install_default_specs</span><span
            class="method-args">(*specs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Install the provided default specs</p>
          
          

          
          <div class="method-source-code" id="install_default_specs-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 719</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_default_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">installer</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">for_spec</span>(<span class="ruby-identifier">spec</span>, <span class="ruby-value">:install_as_default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">installer</span>.<span class="ruby-identifier">install</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">register_default_spec</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install_gem</span><span
            class="method-args">(spec, options = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Builds and installs the <a href="Specification.html">Gem::Specification</a>
<code>spec</code></p>
          
          

          
          <div class="method-source-code" id="install_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 512</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_gem</span> <span class="ruby-identifier">spec</span>, <span class="ruby-identifier">options</span> = {}
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/installer&#39;</span>

  <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&quot;gems&quot;</span>, <span class="ruby-node">&quot;#{spec.full_name}.gem&quot;</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">gem</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">do</span>
        <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">spec</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">gem</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>)).<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">at</span>(<span class="ruby-identifier">gem</span>, <span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({<span class="ruby-value">:wrappers</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>})).<span class="ruby-identifier">install</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install_gem_user" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install_gem_user</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Builds and installs the <a href="Specification.html">Gem::Specification</a>
<code>spec</code> into the user dir</p>
          
          

          
          <div class="method-source-code" id="install_gem_user-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 533</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_gem_user</span> <span class="ruby-identifier">spec</span>
  <span class="ruby-identifier">install_gem</span> <span class="ruby-identifier">spec</span>, <span class="ruby-value">:user_install</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-install_specs" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">install_specs</span><span
            class="method-args">(*specs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Install the provided specs</p>
          
          

          
          <div class="method-source-code" id="install_specs-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 695</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">install_specs</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Installer</span>.<span class="ruby-identifier">for_spec</span>(<span class="ruby-identifier">spec</span>).<span class="ruby-identifier">install</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-loaded_spec_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">loaded_spec_names</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="loaded_spec_names-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 727</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">loaded_spec_names</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:full_name</span>).<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-make_command" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">make_command</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns the make command for the current platform. For versions of Ruby
built on MS Windows with VC++ or Borland it will return &#39;nmake&#39;. On
all other platforms, including Cygwin, it will return &#39;make&#39;.</p>
          
          

          
          <div class="method-source-code" id="make_command-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1159</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">make_command</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;make&quot;</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;MAKE&quot;</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">vc_windows?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;nmake&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;make&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-mu_pp" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">mu_pp</span><span
            class="method-args">(obj)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Enables pretty-print for all tests</p>
          
          

          
          <div class="method-source-code" id="mu_pp-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 564</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">mu_pp</span>(<span class="ruby-identifier">obj</span>)
  <span class="ruby-identifier">s</span> = <span class="ruby-constant">String</span>.<span class="ruby-identifier">new</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-constant">PP</span>.<span class="ruby-identifier">pp</span> <span class="ruby-identifier">obj</span>, <span class="ruby-identifier">s</span>
  <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-constant">Encoding</span>.<span class="ruby-identifier">default_external</span>) <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span> <span class="ruby-constant">Encoding</span>
  <span class="ruby-identifier">s</span>.<span class="ruby-identifier">chomp</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-new_default_spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new_default_spec</span><span
            class="method-args">(name, version, deps = nil, *files)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="new_default_spec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 787</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">new_default_spec</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>)
  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">util_spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@default_spec_dir</span>, <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_name</span>)
  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>

  <span class="ruby-identifier">lib_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&quot;default_gems&quot;</span>, <span class="ruby-string">&quot;lib&quot;</span>)
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">unshift</span>(<span class="ruby-identifier">lib_dir</span>)
  <span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">rb_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">lib_dir</span>, <span class="ruby-identifier">file</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">rb_path</span>))
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">rb_path</span>, <span class="ruby-string">&quot;w&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rb</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">rb</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;# #{file}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-nmake_found-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">nmake_found?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns whether or not the nmake command could be found.</p>
          
          

          
          <div class="method-source-code" id="nmake_found-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">nmake_found?</span>
  <span class="ruby-identifier">system</span>(<span class="ruby-string">&#39;nmake /? 1&gt;NUL 2&gt;&amp;1&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-parse_make_command_line" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">parse_make_command_line</span><span
            class="method-args">(line)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="parse_make_command_line-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 143</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">parse_make_command_line</span>(<span class="ruby-identifier">line</span>)
  <span class="ruby-identifier">command</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">args</span> = <span class="ruby-identifier">line</span>.<span class="ruby-identifier">shellsplit</span>

  <span class="ruby-identifier">targets</span> = []
  <span class="ruby-identifier">macros</span> = {}

  <span class="ruby-identifier">args</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">arg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">case</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/\A(\w+)=/</span>
      <span class="ruby-identifier">macros</span>[<span class="ruby-node">$1</span>] = <span class="ruby-node">$&#39;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">targets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">arg</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">targets</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">targets</span>.<span class="ruby-identifier">empty?</span>

  {
    <span class="ruby-value">:command</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">command</span>,
    <span class="ruby-value">:targets</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">targets</span>,
    <span class="ruby-value">:macros</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">macros</span>,
  }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-process_based_port" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">process_based_port</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>See <a
href="TestCase.html#method-c-process_based_port">::process_based_port</a></p>
          
          

          
          <div class="method-source-code" id="process_based_port-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1190</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">process_based_port</span>
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">process_based_port</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-quick_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">quick_gem</span><span
            class="method-args">(name, version='2') { |s| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a <a href="Specification.html">Gem::Specification</a> with a
minimum of extra work.  <code>name</code> and <code>version</code> are the
gem&#39;s name and version,  platform, author, email, homepage, summary and
description are defaulted.  The specification is yielded for customization.</p>

<p>The gem is added to the installed gems in +@gemhome+ and the runtime.</p>

<p>Use this with <a href="TestCase.html#method-i-write_file">write_file</a> to
build an installed gem.</p>
          
          

          
          <div class="method-source-code" id="quick_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 616</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>=<span class="ruby-string">&#39;2&#39;</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/specification&#39;</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-string">&#39;A User&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-string">&#39;example@example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-string">&#39;http://example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-string">&quot;this is a summary&quot;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;This is a test description&quot;</span>

    <span class="ruby-keyword">yield</span>(<span class="ruby-identifier">s</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">map</span> <span class="ruby-comment"># HACK: force specs to (re-)load before we write</span>

  <span class="ruby-identifier">written_path</span> = <span class="ruby-identifier">write_file</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby_for_cache</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-identifier">written_path</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-read_binary" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_binary</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reads a binary file at <code>path</code></p>
          
          

          
          <div class="method-source-code" id="read_binary-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 583</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_binary</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">read_binary</span> <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-read_cache" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">read_cache</span><span
            class="method-args">(path)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Reads a <a href="../Marshal.html">Marshal</a> file at <code>path</code></p>
          
          

          
          <div class="method-source-code" id="read_cache-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 574</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">read_cache</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>.<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">untaint</span>, <span class="ruby-string">&#39;rb&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span> <span class="ruby-identifier">io</span>.<span class="ruby-identifier">read</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-refute_path_exists" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">refute_path_exists</span><span
            class="method-args">(path, msg = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>TODO: move to minitest</p>
          
          

          
          <div class="method-source-code" id="refute_path_exists-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 134</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">refute_path_exists</span> <span class="ruby-identifier">path</span>, <span class="ruby-identifier">msg</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">msg</span> = <span class="ruby-identifier">message</span>(<span class="ruby-identifier">msg</span>) { <span class="ruby-node">&quot;Expected path &#39;#{path}&#39; to not exist&quot;</span> }
  <span class="ruby-identifier">refute</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">path</span>), <span class="ruby-identifier">msg</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-req" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">req</span><span
            class="method-args">(*requirements)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constructs a new <a href="Requirement.html">Gem::Requirement</a>.</p>
          
          

          
          <div class="method-source-code" id="req-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1276</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">req</span> <span class="ruby-operator">*</span><span class="ruby-identifier">requirements</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">requirements</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span> <span class="ruby-operator">===</span> <span class="ruby-identifier">requirements</span>.<span class="ruby-identifier">first</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Requirement</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">requirements</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_gemspec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_gemspec</span><span
            class="method-args">(name = 'a', version = 1, directory = '.') { |specification| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>create_gemspec creates gem specification in given <code>directory</code> or
&#39;.&#39; for the given <code>name</code> and <code>version</code>.</p>

<p>Yields the <code>specification</code> to the block, if given</p>
          
          

          
          <div class="method-source-code" id="save_gemspec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1341</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_gemspec</span> <span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>, <span class="ruby-identifier">directory</span> = <span class="ruby-string">&#39;.&#39;</span>
  <span class="ruby-identifier">vendor_spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">specification</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">specification</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">open</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">directory</span>, <span class="ruby-node">&quot;#{name}.gemspec&quot;</span>), <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">vendor_spec</span>.<span class="ruby-identifier">to_ruby</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">vendor_spec</span>.<span class="ruby-identifier">version</span>, <span class="ruby-identifier">directory</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-save_loaded_features" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">save_loaded_features</span><span
            class="method-args">() { || ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="save_loaded_features-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 735</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">save_loaded_features</span>
  <span class="ruby-identifier">old_loaded_features</span> = <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">yield</span>
<span class="ruby-keyword">ensure</span>
  <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">replace</span> <span class="ruby-identifier">old_loaded_features</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-scan_make_command_lines" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">scan_make_command_lines</span><span
            class="method-args">(output)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="scan_make_command_lines-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 139</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">scan_make_command_lines</span>(<span class="ruby-identifier">output</span>)
  <span class="ruby-identifier">output</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-node">/^#{Regexp.escape make_command}(?:[[:blank:]].*)?$/</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-setup" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">setup</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TestCase.html#method-i-setup">setup</a> prepares a sandboxed
location to install gems.  All installs are directed to a temporary
directory.  All install plugins are removed.</p>

<p>If the <code>RUBY</code> environment variable is set the given path is used
for <a href="../Gem.html#method-c-ruby">Gem.ruby</a>.  The local platform
is set to <code>i386-mswin32</code> for Windows or
<code>i686-darwin8.10.1</code> otherwise.</p>

<p>If the <code>KEEP_FILES</code> environment variable is set the files will
not be removed from <code>/tmp/test_rubygems_#{$$}.#{Time.now.to_i}</code>.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="setup-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">setup</span>
  <span class="ruby-keyword">super</span>

  <span class="ruby-ivar">@orig_gem_home</span>   = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_HOME&#39;</span>]
  <span class="ruby-ivar">@orig_gem_path</span>   = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PATH&#39;</span>]
  <span class="ruby-ivar">@orig_gem_vendor</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>]
  <span class="ruby-ivar">@orig_gem_spec_cache</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_SPEC_CACHE&#39;</span>]
  <span class="ruby-ivar">@orig_rubygems_gemdeps</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_GEMDEPS&#39;</span>]
  <span class="ruby-ivar">@orig_rubygems_host</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_HOST&#39;</span>]
  <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">find_all</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-string">&#39;GEM_REQUIREMENT_&#39;</span>) }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">k</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@orig_gem_env_requirements</span> = <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">to_hash</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>] = <span class="ruby-keyword">nil</span>

  <span class="ruby-ivar">@current_dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>
  <span class="ruby-ivar">@fetcher</span>     = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@ui</span>          = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">tmpdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">tmpdir</span>
  <span class="ruby-identifier">tmpdir</span>.<span class="ruby-identifier">untaint</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;KEEP_FILES&#39;</span>] <span class="ruby-keyword">then</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}.#{Time.now.to_i}&quot;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">tmpdir</span>, <span class="ruby-node">&quot;test_rubygems_#{$$}&quot;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@tempdir</span>

  <span class="ruby-comment"># This makes the tempdir consistent on OS X.</span>
  <span class="ruby-comment"># File.expand_path Dir.tmpdir                      #=&gt; &quot;/var/...&quot;</span>
  <span class="ruby-comment"># Dir.chdir Dir.tmpdir do File.expand_path &#39;.&#39; end #=&gt; &quot;/private/var/...&quot;</span>
  <span class="ruby-comment"># TODO use File#realpath above instead of #expand_path once 1.8 support is</span>
  <span class="ruby-comment"># dropped.</span>
  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">do</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span> <span class="ruby-string">&#39;.&#39;</span>
    <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># This makes the tempdir consistent on Windows.</span>
  <span class="ruby-comment"># Dir.tmpdir may return short path name, but Dir[Dir.tmpdir] returns long</span>
  <span class="ruby-comment"># path name. https://bugs.ruby-lang.org/issues/10819</span>
  <span class="ruby-comment"># File.expand_path or File.realpath doesn&#39;t convert path name to long path</span>
  <span class="ruby-comment"># name. Only Dir[] (= Dir.glob) works.</span>
  <span class="ruby-comment"># Short and long path name is specific to Windows filesystem.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">win_platform?</span>
    <span class="ruby-ivar">@tempdir</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-ivar">@tempdir</span>][<span class="ruby-value">0</span>]
    <span class="ruby-ivar">@tempdir</span>.<span class="ruby-identifier">untaint</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@gemhome</span>  = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;gemhome&#39;</span>
  <span class="ruby-ivar">@userhome</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;userhome&#39;</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&quot;GEM_SPEC_CACHE&quot;</span>] = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;spec_cache&#39;</span>

  <span class="ruby-ivar">@orig_ruby</span> = <span class="ruby-keyword">if</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBY&#39;</span>] <span class="ruby-keyword">then</span>
                 <span class="ruby-identifier">ruby</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span>
                 <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBY&#39;</span>]
                 <span class="ruby-identifier">ruby</span>
               <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@git</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GIT&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;git&#39;</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ensure_gem_subdirectories</span> <span class="ruby-ivar">@gemhome</span>

  <span class="ruby-ivar">@orig_LOAD_PATH</span> = <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    (<span class="ruby-identifier">expand_path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">s</span>)) <span class="ruby-operator">==</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">expand_path</span>.<span class="ruby-identifier">untaint</span>
  }

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@tempdir</span>

  <span class="ruby-ivar">@orig_ENV_HOME</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>] = <span class="ruby-ivar">@userhome</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@user_home</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@gemdeps</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@env_requirements_by_name</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_instance_variable</span>, <span class="ruby-value">:@ruby_version</span> <span class="ruby-keyword">if</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value">:@ruby_version</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@gemhome</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@userhome</span>

  <span class="ruby-ivar">@orig_gem_private_key_passphrase</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>]
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>] = <span class="ruby-constant">PRIVATE_KEY_PASSPHRASE</span>

  <span class="ruby-ivar">@default_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;default&#39;</span>
  <span class="ruby-ivar">@default_spec_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@default_dir</span>, <span class="ruby-string">&quot;specifications&quot;</span>, <span class="ruby-string">&quot;default&quot;</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@default_dir</span>, <span class="ruby-ivar">@default_dir</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-ivar">@default_spec_dir</span>

  <span class="ruby-comment"># We use Gem::Specification.reset the first time only so that if there</span>
  <span class="ruby-comment"># are unresolved deps that leak into the whole test suite, they&#39;re at least</span>
  <span class="ruby-comment"># reported once.</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">@@initial_reset</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span> <span class="ruby-comment"># done to avoid cross-test warnings</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">@@initial_reset</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">use_paths</span>(<span class="ruby-ivar">@gemhome</span>)

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Security</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">loaded_specs</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">clear_default_specs</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">configuration</span>.<span class="ruby-identifier">update_sources</span> = <span class="ruby-keyword">true</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">FakeFetcher</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-ivar">@gem_repo</span> = <span class="ruby-string">&quot;http://gems.example.com/&quot;</span>
  <span class="ruby-ivar">@uri</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span> <span class="ruby-ivar">@gem_repo</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">sources</span>.<span class="ruby-identifier">replace</span> [<span class="ruby-ivar">@gem_repo</span>]

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">searcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@orig_BASERUBY</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>]
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>] = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;ruby_install_name&#39;</span>]

  <span class="ruby-ivar">@orig_arch</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>]

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">win_platform?</span>
    <span class="ruby-identifier">util_set_arch</span> <span class="ruby-string">&#39;i386-mswin32&#39;</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">util_set_arch</span> <span class="ruby-string">&#39;i686-darwin8.10.1&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@marshal_version</span> = <span class="ruby-node">&quot;#{Marshal::MAJOR_VERSION}.#{Marshal::MINOR_VERSION}&quot;</span>
  <span class="ruby-ivar">@orig_LOADED_FEATURES</span> = <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">dup</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spec</span><span
            class="method-args">(name, version, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Constructs a new <a href="Specification.html">Gem::Specification</a>.</p>
          
          

          
          <div class="method-source-code" id="spec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">v</span>(<span class="ruby-identifier">version</span>), <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-spec_fetcher" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">spec_fetcher</span><span
            class="method-args">(repository = @gem_repo) { |spec_fetcher_setup| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a SpecFetcher pre-filled with the gems or specs defined in the
block.</p>

<p>Yields a <code>fetcher</code> object that responds to <code>spec</code> and
<code>gem</code>.  <code>spec</code> adds a specification to the
SpecFetcher while <code>gem</code> adds both a specification and the gem
data to the RemoteFetcher so the built gem can be downloaded.</p>

<p>If only the a-3 gem is supposed to be downloaded you can save setup time by
creating only specs for the other versions:</p>

<pre class="ruby"><span class="ruby-identifier">spec_fetcher</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fetcher</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">spec</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-value">1</span>
  <span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">spec</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-value">2</span>, <span class="ruby-string">&#39;b&#39;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> <span class="ruby-comment"># dependency on b = 3</span>
  <span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">gem</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-value">3</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-comment"># spec is a Gem::Specification</span>
    <span class="ruby-comment"># ...</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>
          
          

          
          <div class="method-source-code" id="spec_fetcher-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1308</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">spec_fetcher</span> <span class="ruby-identifier">repository</span> = <span class="ruby-ivar">@gem_repo</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">TestCase</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcherSetup</span>.<span class="ruby-identifier">declare</span> <span class="ruby-keyword">self</span>, <span class="ruby-identifier">repository</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec_fetcher_setup</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">spec_fetcher_setup</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-teardown" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">teardown</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="TestCase.html#method-i-teardown">teardown</a> restores the process
to its original state and removes the tempdir unless the
<code>KEEP_FILES</code> environment variable was set.</p>
          
          

          
          <div class="method-source-code" id="teardown-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 356</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">teardown</span>
  <span class="ruby-identifier">$LOAD_PATH</span>.<span class="ruby-identifier">replace</span> <span class="ruby-ivar">@orig_LOAD_PATH</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOAD_PATH</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_LOAD_PATH</span>
      <span class="ruby-identifier">paths</span> = <span class="ruby-ivar">@orig_LOAD_PATH</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">path</span>), <span class="ruby-string">&quot;/&quot;</span>)}
      (<span class="ruby-identifier">$LOADED_FEATURES</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">feat</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">unless</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">any?</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span> <span class="ruby-identifier">feat</span>.<span class="ruby-identifier">start_with?</span>(<span class="ruby-identifier">path</span>)}
          <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">feat</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">$LOADED_FEATURES</span>.<span class="ruby-identifier">replace</span> <span class="ruby-ivar">@orig_LOADED_FEATURES</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_BASERUBY</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;BASERUBY&#39;</span>] = <span class="ruby-ivar">@orig_BASERUBY</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;BASERUBY&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>] = <span class="ruby-ivar">@orig_arch</span>

  <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-ivar">@current_dir</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-ivar">@tempdir</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;KEEP_FILES&#39;</span>]

  <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">clear</span>
  <span class="ruby-ivar">@orig_gem_env_requirements</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">v</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_HOME&#39;</span>]   = <span class="ruby-ivar">@orig_gem_home</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PATH&#39;</span>]   = <span class="ruby-ivar">@orig_gem_path</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_VENDOR&#39;</span>] = <span class="ruby-ivar">@orig_gem_vendor</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_SPEC_CACHE&#39;</span>] = <span class="ruby-ivar">@orig_gem_spec_cache</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_GEMDEPS&#39;</span>] = <span class="ruby-ivar">@orig_rubygems_gemdeps</span>
  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;RUBYGEMS_HOST&#39;</span>] = <span class="ruby-ivar">@orig_rubygems_host</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">ruby</span> = <span class="ruby-ivar">@orig_ruby</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_ruby</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@orig_ENV_HOME</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;HOME&#39;</span>] = <span class="ruby-ivar">@orig_ENV_HOME</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">ENV</span>.<span class="ruby-identifier">delete</span> <span class="ruby-string">&#39;HOME&#39;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@default_dir</span>, <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">ENV</span>[<span class="ruby-string">&#39;GEM_PRIVATE_KEY_PASSPHRASE&#39;</span>] = <span class="ruby-ivar">@orig_gem_private_key_passphrase</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_clear_load_cache</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">clear</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-uninstall_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">uninstall_gem</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Uninstalls the <a href="Specification.html">Gem::Specification</a>
<code>spec</code></p>
          
          

          
          <div class="method-source-code" id="uninstall_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 539</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">uninstall_gem</span> <span class="ruby-identifier">spec</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/uninstaller&#39;</span>

  <span class="ruby-constant">Class</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Uninstaller</span>) {
    <span class="ruby-keyword">def</span> <span class="ruby-identifier">ask_if_ok</span> <span class="ruby-identifier">spec</span>
      <span class="ruby-keyword">true</span>
    <span class="ruby-keyword">end</span>
  }.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name</span>, <span class="ruby-value">:executables</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">:user_install</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span>).<span class="ruby-identifier">uninstall</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-unresolved_names" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">unresolved_names</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="unresolved_names-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 731</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">unresolved_names</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">unresolved_deps</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:to_s</span>).<span class="ruby-identifier">sort</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_build_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_build_gem</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Builds a gem from <code>spec</code> and places it in <code>File.join
@gemhome, &#39;cache&#39;</code>.  Automatically creates files based on
<code>spec.files</code></p>
          
          

          
          <div class="method-source-code" id="util_build_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 656</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_build_gem</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">gem_dir</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>

  <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword">do</span>
    <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">file</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">file</span>)
      <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span> <span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;w&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">fp</span><span class="ruby-operator">|</span> <span class="ruby-identifier">fp</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;# #{file}&quot;</span> <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">use_ui</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">MockGemUi</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Package</span>.<span class="ruby-identifier">build</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">cache</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">cache</span>), <span class="ruby-identifier">cache</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_clear_gems" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_clear_gems</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Removes all installed gems from +@gemhome+.</p>
          
          

          
          <div class="method-source-code" id="util_clear_gems-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 684</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_clear_gems</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>) <span class="ruby-comment"># TODO: use Gem::Dirs</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;specifications&quot;</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;specifications&quot;</span>)
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_gem</span><span
            class="method-args">(name, version, deps = nil, &block)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a gem with <code>name</code>, <code>version</code> and
<code>deps</code>.  The specification will be yielded before gem creation
for customization.  The gem will be placed in <code>File.join @tempdir,
&#39;gems&#39;</code>.  The specification and .gem file location are
returned.</p>
          
          

          
          <div class="method-source-code" id="util_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 845</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-comment"># TODO: deprecate</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">block</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">block</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-comment"># Since Hash#each is unordered in 1.8, sort</span>
      <span class="ruby-comment"># the keys and iterate that way so the tests are</span>
      <span class="ruby-comment"># deterministic on all implementations.</span>
      <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">deps</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&gt;= 0&#39;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)

  <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>

  <span class="ruby-identifier">cache_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@tempdir</span>, <span class="ruby-string">&#39;gems&#39;</span>, <span class="ruby-node">&quot;#{spec.original_name}.gem&quot;</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mv</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>, <span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>

  <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">loaded_from</span> = <span class="ruby-keyword">nil</span>

  [<span class="ruby-identifier">spec</span>, <span class="ruby-identifier">cache_file</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_gzip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_gzip</span><span
            class="method-args">(data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Gzips <code>data</code>.</p>
          
          

          
          <div class="method-source-code" id="util_gzip-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 877</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_gzip</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-identifier">out</span> = <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">wrap</span> <span class="ruby-identifier">out</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">io</span>.<span class="ruby-identifier">write</span> <span class="ruby-identifier">data</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>.<span class="ruby-identifier">string</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_make_gems" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_make_gems</span><span
            class="method-args">(prerelease = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates several default gems which all have a lib/code.rb file.  The gems
are not installed but are available in the cache dir.</p>
<dl class="rdoc-list note-list"><dt>+@a1+
<dd>
<p>gem a version 1, this is the best-described gem.</p>
</dd><dt>+@a2+
<dd>
<p>gem a version 2</p>
</dd><dt>+@a3a
<dd>
<p>gem a version 3.a</p>
</dd><dt>+@a_evil9+
<dd>
<p>gem a_evil version 9, use this to ensure similarly-named gems don&#39;t
collide with a.</p>
</dd><dt>+@b2+
<dd>
<p>gem b version 2</p>
</dd><dt>+@c1_2+
<dd>
<p>gem c version 1.2</p>
</dd><dt>+@pl1+
<dd>
<p>gem pl version 1, this gem has a legacy platform of i386-linux.</p>
</dd></dl>

<p>Additional <code>prerelease</code> gems may also be created:</p>
<dl class="rdoc-list note-list"><dt>+@a2_pre+
<dd>
<p>gem a version 2.a</p>
</dd></dl>

<p>TODO: nuke this and fix tests. this should speed up a lot</p>
          
          

          
          <div class="method-source-code" id="util_make_gems-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 905</span>
  <span class="ruby-keyword">def</span> <span class="ruby-identifier">util_make_gems</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword">false</span>)
    <span class="ruby-ivar">@a1</span> = <span class="ruby-identifier">quick_gem</span> <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">date</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">TODAY</span> <span class="ruby-operator">-</span> <span class="ruby-value">86400</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span> = <span class="ruby-string">&#39;http://a.example.com&#39;</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span> = <span class="ruby-node">%w[example@example.com example2@example.com]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">authors</span> = <span class="ruby-node">%w[Example Example2]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value">&lt;&lt;-DESC
This line is really, really long.  So long, in fact, that it is more than eighty characters long!  The purpose of this line is for testing wrapping behavior because sometimes people don&#39;t wrap their text to eighty characters.  Without the wrapping, the text might not look good in the RSS feed.

Also, a list:
  * An entry that\&#39;s actually kind of sort
  * an entry that\&#39;s really long, which will probably get wrapped funny.  That&#39;s ok, somebody wasn&#39;t thinking straight when they made it more than eighty characters.
      DESC</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">init</span> = <span class="ruby-identifier">proc</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@a2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;2&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@a3a</span>     = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;3.a&#39;</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@a_evil9</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a_evil&#39;</span>, <span class="ruby-string">&#39;9&#39;</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@b2</span>      = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;b&#39;</span>, <span class="ruby-string">&#39;2&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@c1_2</span>    = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;c&#39;</span>, <span class="ruby-string">&#39;1.2&#39;</span>,    <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@x</span>       = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;x&#39;</span>, <span class="ruby-string">&#39;1&#39;</span>,      <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
    <span class="ruby-ivar">@dep_x</span>   = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;dep_x&#39;</span>, <span class="ruby-string">&#39;1&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-string">&#39;x&#39;</span>, <span class="ruby-string">&#39;&gt;= 1&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@pl1</span>     = <span class="ruby-identifier">quick_gem</span> <span class="ruby-string">&#39;pl&#39;</span>, <span class="ruby-string">&#39;1&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span> <span class="ruby-comment"># l for legacy</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-node">%w[lib/code.rb]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-node">%w[lib]</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-string">&#39;i386-linux&#39;</span>
      <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@original_platform</span>, <span class="ruby-string">&#39;i386-linux&#39;</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">prerelease</span>
      <span class="ruby-ivar">@a2_pre</span> = <span class="ruby-identifier">quick_gem</span>(<span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-string">&#39;2.a&#39;</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">init</span>)
      <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a2_pre.original_name} lib code.rb]</span>)
      <span class="ruby-identifier">util_build_gem</span> <span class="ruby-ivar">@a2_pre</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a1.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a2.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a3a.original_name}     lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@a_evil9.original_name} lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@b2.original_name}      lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@c1_2.original_name}    lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@pl1.original_name}     lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@x.original_name}       lib code.rb]</span>)
    <span class="ruby-identifier">write_file</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-operator">*</span><span class="ruby-node">%W[gems #{@dep_x.original_name}   lib code.rb]</span>)

    [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>, <span class="ruby-ivar">@pl1</span>, <span class="ruby-ivar">@x</span>, <span class="ruby-ivar">@dep_x</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">util_build_gem</span> <span class="ruby-identifier">spec</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_r</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@gemhome</span>, <span class="ruby-string">&quot;gems&quot;</span>, <span class="ruby-ivar">@pl1</span>.<span class="ruby-identifier">original_name</span>)
  <span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_remove_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_remove_gem</span><span
            class="method-args">(spec)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="util_remove_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 676</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_remove_gem</span>(<span class="ruby-identifier">spec</span>)
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">cache_file</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">spec_file</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_restore_RUBY_VERSION" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_restore_RUBY_VERSION</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="util_restore_RUBY_VERSION-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1103</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_restore_RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_PATCHLEVEL</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_PATCHLEVEL</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_REVISION</span>   <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_REVISION</span>)

  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_VERSION</span>,    <span class="ruby-ivar">@RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_PATCHLEVEL</span>, <span class="ruby-ivar">@RUBY_PATCHLEVEL</span> <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_PATCHLEVEL</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_REVISION</span>,   <span class="ruby-ivar">@RUBY_REVISION</span>   <span class="ruby-keyword">if</span>
    <span class="ruby-keyword">defined?</span>(<span class="ruby-ivar">@RUBY_REVISION</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_set_RUBY_VERSION" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_set_RUBY_VERSION</span><span
            class="method-args">(version, patchlevel = nil, revision = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="util_set_RUBY_VERSION-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1084</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_set_RUBY_VERSION</span>(<span class="ruby-identifier">version</span>, <span class="ruby-identifier">patchlevel</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">revision</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value">:@ruby_version</span> <span class="ruby-keyword">or</span>
     <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">include?</span> <span class="ruby-string">&#39;@ruby_version&#39;</span> <span class="ruby-keyword">then</span>
    <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_instance_variable</span>, <span class="ruby-value">:@ruby_version</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@RUBY_VERSION</span>    = <span class="ruby-constant">RUBY_VERSION</span>
  <span class="ruby-ivar">@RUBY_PATCHLEVEL</span> = <span class="ruby-constant">RUBY_PATCHLEVEL</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_PATCHLEVEL</span>)
  <span class="ruby-ivar">@RUBY_REVISION</span>   = <span class="ruby-constant">RUBY_REVISION</span>   <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_REVISION</span>)

  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_VERSION</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_PATCHLEVEL</span> <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_PATCHLEVEL</span>)
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">send</span> <span class="ruby-value">:remove_const</span>, <span class="ruby-value">:RUBY_REVISION</span>   <span class="ruby-keyword">if</span> <span class="ruby-keyword">defined?</span>(<span class="ruby-constant">RUBY_REVISION</span>)

  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_VERSION</span>,    <span class="ruby-identifier">version</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_PATCHLEVEL</span>, <span class="ruby-identifier">patchlevel</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">patchlevel</span>
  <span class="ruby-constant">Object</span>.<span class="ruby-identifier">const_set</span> <span class="ruby-value">:RUBY_REVISION</span>,   <span class="ruby-identifier">revision</span>   <span class="ruby-keyword">if</span> <span class="ruby-identifier">revision</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_set_arch" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_set_arch</span><span
            class="method-args">(arch)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p><a href="../Set.html">Set</a> the platform to <code>arch</code></p>
          
          

          
          <div class="method-source-code" id="util_set_arch-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 972</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_set_arch</span>(<span class="ruby-identifier">arch</span>)
  <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-string">&#39;arch&#39;</span>] = <span class="ruby-identifier">arch</span>
  <span class="ruby-identifier">platform</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">new</span> <span class="ruby-identifier">arch</span>

  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@platforms</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">instance_variable_set</span> <span class="ruby-value">:@local</span>, <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">platform</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_setup_fake_fetcher" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_setup_fake_fetcher</span><span
            class="method-args">(prerelease = false)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets up a fake fetcher using the gems from <a
href="TestCase.html#method-i-util_make_gems">util_make_gems</a>. 
Optionally additional <code>prerelease</code> gems may be included.</p>

<p>Gems created by this method may be fetched using <a
href="RemoteFetcher.html">Gem::RemoteFetcher</a>.</p>
          
          

          
          <div class="method-source-code" id="util_setup_fake_fetcher-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 988</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_setup_fake_fetcher</span>(<span class="ruby-identifier">prerelease</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;zlib&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;socket&#39;</span>
  <span class="ruby-identifier">require</span> <span class="ruby-string">&#39;rubygems/remote_fetcher&#39;</span>

  <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">FakeFetcher</span>.<span class="ruby-identifier">new</span>

  <span class="ruby-identifier">util_make_gems</span>(<span class="ruby-identifier">prerelease</span>)
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-ivar">@all_gems</span> = [<span class="ruby-ivar">@a1</span>, <span class="ruby-ivar">@a2</span>, <span class="ruby-ivar">@a3a</span>, <span class="ruby-ivar">@a_evil9</span>, <span class="ruby-ivar">@b2</span>, <span class="ruby-ivar">@c1_2</span>].<span class="ruby-identifier">sort</span>
  <span class="ruby-ivar">@all_gem_names</span> = <span class="ruby-ivar">@all_gems</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">gem</span><span class="ruby-operator">|</span> <span class="ruby-identifier">gem</span>.<span class="ruby-identifier">full_name</span> }

  <span class="ruby-identifier">gem_names</span> = [<span class="ruby-ivar">@a1</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a2</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@a3a</span>.<span class="ruby-identifier">full_name</span>, <span class="ruby-ivar">@b2</span>.<span class="ruby-identifier">full_name</span>]
  <span class="ruby-ivar">@gem_names</span> = <span class="ruby-identifier">gem_names</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span>.<span class="ruby-identifier">fetcher</span> = <span class="ruby-ivar">@fetcher</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_setup_spec_fetcher" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_setup_spec_fetcher</span><span
            class="method-args">(*specs)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Sets up <a href="SpecFetcher.html">Gem::SpecFetcher</a> to return
information from the gems in <code>specs</code>. Best used with +@all_gems+
from <a
href="TestCase.html#method-i-util_setup_fake_fetcher">util_setup_fake_fetcher</a>.</p>
          
          

          
          <div class="method-source-code" id="util_setup_spec_fetcher-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1020</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_setup_spec_fetcher</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">specs</span>)
  <span class="ruby-identifier">all_specs</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">to_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">specs</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_resort!</span> <span class="ruby-identifier">all_specs</span>

  <span class="ruby-identifier">spec_fetcher</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">SpecFetcher</span>.<span class="ruby-identifier">fetcher</span>

  <span class="ruby-identifier">prerelease</span>, <span class="ruby-identifier">all</span> = <span class="ruby-identifier">all_specs</span>.<span class="ruby-identifier">partition</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">prerelease?</span>  }
  <span class="ruby-identifier">latest</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">_latest_specs</span> <span class="ruby-identifier">all_specs</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">all</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">latest_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] = []
  <span class="ruby-identifier">prerelease</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">spec_fetcher</span>.<span class="ruby-identifier">prerelease_specs</span>[<span class="ruby-ivar">@uri</span>] <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># HACK for test_download_to_cache</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">RemoteFetcher</span> <span class="ruby-operator">===</span> <span class="ruby-ivar">@fetcher</span> <span class="ruby-keyword">then</span>
    <span class="ruby-identifier">v</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">marshal_version</span>

    <span class="ruby-identifier">specs</span> = <span class="ruby-identifier">all</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span> }
    <span class="ruby-identifier">s_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">specs</span>

    <span class="ruby-identifier">latest_specs</span> = <span class="ruby-identifier">latest</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">l_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">latest_specs</span>

    <span class="ruby-identifier">prerelease_specs</span> = <span class="ruby-identifier">prerelease</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">name_tuple</span> }
    <span class="ruby-identifier">p_zip</span> = <span class="ruby-identifier">util_gzip</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">NameTuple</span>.<span class="ruby-identifier">to_basic</span> <span class="ruby-identifier">prerelease_specs</span>

    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}specs.#{v}.gz&quot;</span>]            = <span class="ruby-identifier">s_zip</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}latest_specs.#{v}.gz&quot;</span>]     = <span class="ruby-identifier">l_zip</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-node">&quot;#{@gem_repo}prerelease_specs.#{v}.gz&quot;</span>] = <span class="ruby-identifier">p_zip</span>

    <span class="ruby-identifier">v</span> = <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">marshal_version</span>

    <span class="ruby-identifier">all_specs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">spec</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">path</span> = <span class="ruby-node">&quot;#{@gem_repo}quick/Marshal.#{v}/#{spec.original_name}.gemspec.rz&quot;</span>
      <span class="ruby-identifier">data</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span> <span class="ruby-identifier">spec</span>
      <span class="ruby-identifier">data_deflate</span> = <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
      <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">data</span>[<span class="ruby-identifier">path</span>] = <span class="ruby-identifier">data_deflate</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">nil</span> <span class="ruby-comment"># force errors</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_spec" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_spec</span><span
            class="method-args">(name, version = 2, deps = nil) { |specification| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Creates a spec with <code>name</code>, <code>version</code>. 
<code>deps</code> can specify the dependency or a <code>block</code> can be
given for full customization of the specification.</p>
          
          

          
          <div class="method-source-code" id="util_spec-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 810</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_spec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">2</span>, <span class="ruby-identifier">deps</span> = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># :yields: specification</span>
  <span class="ruby-identifier">raise</span> <span class="ruby-string">&quot;deps or block, not both&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">block_given?</span>

  <span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span>    = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Platform</span><span class="ruby-operator">::</span><span class="ruby-constant">RUBY</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span>        = <span class="ruby-identifier">name</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span>     = <span class="ruby-identifier">version</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span>      = <span class="ruby-string">&#39;A User&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span>       = <span class="ruby-string">&#39;example@example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span>    = <span class="ruby-string">&#39;http://example.com&#39;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span>     = <span class="ruby-string">&quot;this is a summary&quot;</span>
    <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-string">&quot;This is a test description&quot;</span>

    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">s</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">deps</span> <span class="ruby-keyword">then</span>
    <span class="ruby-comment"># Since Hash#each is unordered in 1.8, sort the keys and iterate that</span>
    <span class="ruby-comment"># way so the tests are deterministic on all implementations.</span>
    <span class="ruby-identifier">deps</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">add_dependency</span> <span class="ruby-identifier">n</span>, (<span class="ruby-identifier">deps</span>[<span class="ruby-identifier">n</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;&gt;= 0&#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">reset</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">spec</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-util_zip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">util_zip</span><span
            class="method-args">(data)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Deflates <code>data</code></p>
          
          

          
          <div class="method-source-code" id="util_zip-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1080</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">util_zip</span>(<span class="ruby-identifier">data</span>)
  <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">Deflate</span>.<span class="ruby-identifier">deflate</span> <span class="ruby-identifier">data</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-v" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">v</span><span
            class="method-args">(string)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Construct a new <a href="Version.html">Gem::Version</a>.</p>
          
          

          
          <div class="method-source-code" id="v-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1317</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">v</span> <span class="ruby-identifier">string</span>
  <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Version</span>.<span class="ruby-identifier">create</span> <span class="ruby-identifier">string</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-vc_windows-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">vc_windows?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Returns whether or not we&#39;re on a version of Ruby built with VC++ (or
Borland) versus Cygwin, Mingw, etc.</p>
          
          

          
          <div class="method-source-code" id="vc_windows-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1141</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">vc_windows?</span>
  <span class="ruby-constant">RUBY_PLATFORM</span>.<span class="ruby-identifier">match</span>(<span class="ruby-string">&#39;mswin&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-vendor_gem" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">vendor_gem</span><span
            class="method-args">(name = 'a', version = 1)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>A <a href="TestCase.html#method-i-vendor_gem">#vendor_gem</a> is used with
a gem dependencies file.  The gem created here has no files, just a gem
specification for the given <code>name</code> and <code>version</code>.</p>

<p>Yields the <code>specification</code> to the block, if given</p>
          
          

          
          <div class="method-source-code" id="vendor_gem-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1327</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">vendor_gem</span> <span class="ruby-identifier">name</span> = <span class="ruby-string">&#39;a&#39;</span>, <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>
  <span class="ruby-identifier">directory</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-string">&#39;vendor&#39;</span>, <span class="ruby-identifier">name</span>

  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">directory</span>

  <span class="ruby-identifier">save_gemspec</span> <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-identifier">directory</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-wait_for_child_process_to_exit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">wait_for_child_process_to_exit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>In case we&#39;re building docs in a background process, this method waits
for that process to exit (or if it&#39;s already been reaped, or never
happened, swallows the Errno::ECHILD error).</p>
          
          

          
          <div class="method-source-code" id="wait_for_child_process_to_exit-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">wait_for_child_process_to_exit</span>
  <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Process</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-value">:fork</span>)
<span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ECHILD</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-win_platform-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">win_platform?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is this test being run on a Windows platform?</p>
          
          

          
          <div class="method-source-code" id="win_platform-3F-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 1125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">win_platform?</span>
  <span class="ruby-constant">Gem</span>.<span class="ruby-identifier">win_platform?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-write_file" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">write_file</span><span
            class="method-args">(path) { |io| ... }</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Writes a binary file to <code>path</code> which is relative to +@gemhome+</p>
          
          

          
          <div class="method-source-code" id="write_file-source">
            <pre><span class="ruby-comment"># File lib/rubygems/test_case.rb, line 590</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">write_file</span>(<span class="ruby-identifier">path</span>)
  <span class="ruby-identifier">path</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span> <span class="ruby-ivar">@gemhome</span>, <span class="ruby-identifier">path</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">Pathname</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">path</span>).<span class="ruby-identifier">absolute?</span>
  <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span> <span class="ruby-identifier">path</span>
  <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span> <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span> <span class="ruby-identifier">dir</span>

  <span class="ruby-identifier">open</span> <span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;wb&#39;</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">io</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">yield</span> <span class="ruby-identifier">io</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">block_given?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">path</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

