///////////////////////////////////////////////////////////////////////////////
// The hostPort is the serial port to the host computer - the Raspberry Pi. 
///////////////////////////////////////////////////////////////////////////////

#include "constants.h"
#include "commands.h"

///////////////////////////////////////////////////////////////////////////////
// local global variables
///////////////////////////////////////////////////////////////////////////////
bool hostPortin = false;
uint16  serialin = true;

union cmdData command;

///////////////////////////////////////////////////////////////////////////////
// Function templates
///////////////////////////////////////////////////////////////////////////////
int hostPortEvent();


///////////////////////////////////////////////////////////////////////////////
// initHostPort - initialize the communications to/from the host
///////////////////////////////////////////////////////////////////////////////
void initHostPort ()
{
    RPIPORT.begin(115200);
}

///////////////////////////////////////////////////////////////////////////////
// checkForCmds - called from the main loop
///////////////////////////////////////////////////////////////////////////////

void checkForCmds (uint32_t currTimeMsec)
{
  if (serialin)
  {
      if (hostPortEvent() == 8) // A valid command consists of 8 (bytes)
      {
          commandDecode(&command);
      }
  }
}


///////////////////////////////////////////////////////////////////////////////
// void hostPortEvent() - checks if there are 8 bytes at the serial port and if
// if so reads them into command and returns the number of bytes read 
// (should always be either 0 or 8)
///////////////////////////////////////////////////////////////////////////////

int hostPortEvent()
{
    if (RPIPORT.available() >= 8) // A valid command consists of 8 (bytes)
    {
        for (int i = 0; i < 8; i++)
        {
            command.bytes[i] = RPIPORT.read();           
        }
        return (8);
    }
    return (0);
}

///////////////////////////////////////////////////////////////////////////////
// 
///////////////////////////////////////////////////////////////////////////////